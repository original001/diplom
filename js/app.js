// Generated by CoffeeScript 1.8.0
var cordovaApp;

angular.module('Monitor', ['ngMaterial', 'ngRoute', 'Diplom.controllers.Main', 'Diplom.services.Main']).config(function($routeProvider) {
  this.timeNow = new Date().getTime();
  persistence.store.websql.config(persistence, 'sensors2', 'База данных для мониторинга', 5 * 1024 * 1024);
  return $routeProvider.when('/', {
    templateUrl: 'home.html',
    reloadOnSearch: false
  });
}).constant('DB', {
  Obj: persistence.define('Obj', {
    name: "TEXT"
  }),
  SensCat: persistence.define('SensCat', {
    name: "TEXT"
  }),
  SensMany: persistence.define('SensMany', {
    sensor: "INT",
    GroupOfSens: "INT"
  }),
  Sensor: persistence.define('Sensor', {
    name: "TEXT",
    sensCat: "INT",
    date: "DATE"
  }),
  Graph: persistence.define('Graph', {
    sensor: "INT",
    date: "DATE",
    mu: "INT",
    eps: "INT"
  }),
  GroupOfSens: persistence.define('GroupOfSens', {
    name: "TEXT",
    sensCat: "INT",
    obj: "INT"
  }),
  Maps: persistence.define('Maps', {
    floor: "INT",
    obj: "INT",
    sensor: "INT",
    coorx: "INT",
    coory: "INT"
  })
});

cordovaApp = {
  initialize: function() {
    return this.bindEvents();
  },
  bindEvents: function() {
    return document.addEventListener('deviceready', this.onDeviceReady, false);
  },
  onDeviceReady: function() {
    return app.receivedEvent('deviceready');
  },
  receivedEvent: function(id) {
    var listeningElement, parentElement, receivedElement;
    parentElement = document.getElementById(id);
    listeningElement = parentElement.querySelector('.listening');
    receivedElement = parentElement.querySelector('.received');
    listeningElement.setAttribute('style', 'display:none');
    receivedElement.setAttribute('style', 'display:block');
    return console.log('Received Event: ' + id);
  }
};

cordovaApp.initialize();

angular.module('Diplom.controllers.Main', []).controller('MainController', function($scope, Main) {
  $scope.lists = [];
  $scope.count = 0;
  Main.list('Obj', $scope);
  $scope.add = function(name) {
    return Main.add('Obj', {
      name: name
    });
  };
  $scope.remove = function(name) {
    console.log(name);
    return Main.remove('Obj', name);
  };
  return $scope.hello = function(name) {
    return Main.say(name);
  };
});

angular.module('Diplom.services.Main', []).service('Main', function(DB) {
  DB.Obj.hasMany('sensors', DB.Sensor, 'obj');
  DB.Sensor.hasOne('obj', DB.Obj);
  persistence.schemaSync();
  this.list = function(dest, $scope) {
    return DB[dest].all().list(function(items) {
      var arr;
      arr = [];
      return items.forEach(function(item) {
        return item.sensors.list(null, function(res) {
          var count;
          count = res.length;
          arr.push({
            name: item.name,
            page: item.id,
            count: count
          });
          $scope.lists = arr;
          return $scope.$apply();
        });
      });
    });
  };
  this.addObj = function(options) {
    var t;
    t = new DB.Obj(options);
    persistence.add(t);
    return persistence.flush(function() {
      return console.log('flush done');
    });
  };
  this.remove = function(dest, name) {
    return DB[dest].all().filter('name', '=', name).destroyAll(function() {
      return console.log('done');
    });
  };
  this.prefetch = function(name, $scope) {
    return DB.Obj.findBy(persistence, null, 'name', name, function(obj) {
      var arr;
      if (obj) {
        arr = [];
        return obj.sensors.list(null, function(res) {
          $scope.count = res.length;
          return $scope.$apply();
        });
      }
    });
  };
  this.update = function(obj) {};
  this.addSens = function(s, o) {
    s = new DB.Sensor({
      name: s,
      sensCat: "1",
      date: new Date().getTime()
    });
    o = new DB.Obj({
      name: o
    });
    o.sensors.add(s);
    persistence.flush();
    return o.sensors.list(null, function(res) {
      return console.log(res);
    });
  };
  this.say = function(name) {
    return "hello " + name;
  };
});

//# sourceMappingURL=app.js.map
